{% extends "work_space.html" %}

{% block top_bar %}
<a class="bar__item top-bar__home" href="/home/task"></a>
<a class="bar__item" href="/command/{{ command.command_id }}/task">{{ command.name }}</a>
<a class="bar__item" href="">{{ current_group.name }}</a>
{% endblock %}

{% block left_bar %}
	{% if groups %}
		{% for item in groups %}
			<div class="bar__item">
				<a href="/group/{{ item.group_id }}/task">
					<span>{{ item.name }}</span>
				</a>
				{% if item.ownership %}
					<a href="/group/{{ item.group_id }}/settings"></a>
				{% endif %}
			</div>
		{% endfor %}
	{% else %}
		Груп немає, і це мене лякає...
	{% endif %}

	{% if is_owner %}
		<a href="{{ url_for('add_group', command_id=command.command_id) }}" class="add-button add-button_minimize left-bar__add-button">
			<span>Додати групу</span>
			<span></span>
		</a>
	{% endif %}

{% endblock %}

{% block work_area %}
	<div class="work-area__bar">
		<a href="" class="add-button">
			<span>Нове завдання</span>
			<span></span>
		</a>
		<a href="" class="bar__item bar__item_small">
			Події
		</a>
	</div>

	<div class="work-area__board">
		{% if cols %}
			{% for col in cols %}
				<div class="coll">
					<span>{{ col.name }}</span>
					<div class="drop-zone" data-coll="{{ col.col_id }}">
						{% for task in col.tasks %}
							{% if user.user_id in [task.performer_id, task.owner_id] %}
								<div class="task drag-item" draggable="true" data-task="{{ task.task_id }}">
							{% else  %}
								<div class="task" draggable="false">
							{% endif %}

								<a href="" draggable="false">
									<span class="task__doc"></span>
									<p>
										{{ task.description }}
									</p>
									<span class="task__submit-clone"></span>
									<p>
										{{ task.name }}
									</p>
									<p>
										{% if task.start_date %}
											{% if task.end_date %}
												{{ task.start_date }} - {{ task.end_date }}
											{% else %}
												Почати з {{ task.start_date }}
											{% endif %}
										{% elif task.end_date %}
											Закінчити до {{ task.end_date }}
										{% endif %}
									</p>
								</a>

								{% if task.done %}
									<a class="task__submit task__submit_done" data-status="true"></a>
								{% elif user.user_id in [task.performer_id, task.owner_id] %}
									<a class="task__submit" data-status="false"></a>
								{% endif %}
							</div>
						{% endfor %}
					</div>
				</div>
			{% endfor %}
		{% else %}
			Колонок немає...
		{% endif %}
	</div>
{% endblock %}

{% block script %}
	<script src="{{ url_for('static', filename='script/dnd.js') }}"></script>
	<script src="{{ url_for('static', filename='script/task_status.js') }}"></script>
{% endblock %}
